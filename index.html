<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanmati School Election 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #4b5563, #2563eb); color: #1f2937; }
        .slogan { animation: slideIn 2s ease-in-out infinite alternate; }
        @keyframes slideIn { from { transform: translateX(-15px); } to { transform: translateX(15px); } }
        .candidate-card { transition: transform 0.3s, box-shadow 0.3s; }
        .candidate-card:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); }
        .vote-btn { background: linear-gradient(to right, #dc2626, #f97316); transition: background 0.3s; }
        .vote-btn:hover { background: linear-gradient(to right, #f97316, #dc2626); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <header class="text-center mb-12">
        <h1 class="text-5xl font-extrabold text-white animate-pulse">Sanmati School Election 2025</h1>
        <p class="text-2xl text-yellow-300 mt-4 slogan">Shape Tomorrow, Vote Today!</p>
    </header>
    <section class="w-full max-w-lg mt-12 bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Cast Your Vote</h2>
        <form id="voteForm" class="space-y-4">
            <div><label for="name" class="block text-gray-700 font-medium">Full Name</label><input type="text" id="name" required class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
            <div><label for="class" class="block text-gray-700 font-medium">Class</label>
                <select id="class" required class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">--Choose Class--</option>
                    <option value="6th">6th</option>
                    <option value="7th">7th</option>
                    <option value="8th">8th</option>
                    <option value="9th">9th</option>
                    <option value="10th">10th</option>
                </select>
            </div>
            <div><label for="section" class="block text-gray-700 font-medium">Section</label>
                <select id="section" required class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">--Choose Section--</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
            <div><label for="scholarNo" class="block text-gray-700 font-medium">Scholar Number</label><input type="text" id="scholarNo" required class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
            <div><label for="candidate" class="block text-gray-700 font-medium">Select Candidate</label>
                <select id="candidate" required class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">--Choose a Candidate--</option>
                    <option value="Aarav Sharma">Aarav Sharma</option>
                    <option value="Sanya Gupta">Sanya Gupta</option>
                    <option value="Rohan Patel">Rohan Patel</option>
                    <option value="Neha Singh">Neha Singh</option>
                    <option value="Vikram Rao">Vikram Rao</option>
                </select>
            </div>
            <button type="submit" class="vote-btn w-full py-3 text-white font-semibold rounded-md text-lg">Submit Vote</button>
        </form>
        <a href="admin-control.html" class="block text-center mt-4 text-blue-500 hover:underline">View Election Results</a>
    </section>
    <footer class="mt-12 text-center text-white">Â© 2025 Sanmati School. All rights reserved.</footer>

   <script type="module">
    import { initializeApp, deleteApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBmkgfSOSwTfkEnAxsxQ7bE2bGpYryEkGw",
        authDomain: "school-voting-3bdf6.firebaseapp.com",
        projectId: "school-voting-3bdf6",
        storageBucket: "school-voting-3bdf6.firebasestorage.app",
        messagingSenderId: "301663905943",
        appId: "1:301663905943:web:36e0bbe51a4d55968561d2",
        measurementId: "G-4B523LL5S4"
    };

    let app;
    const existingApps = getApps();
    if (existingApps.length) {
        existingApps.forEach(a => a.delete());
    }
    app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById('voteForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value;
        const classVal = document.getElementById('class').value;
        const section = document.getElementById('section').value;
        const scholarNo = document.getElementById('scholarNo').value;
        const candidate = document.getElementById('candidate').value;

        if (!classVal || !section) {
            alert('Please select both class and section.');
            return;
        }

        const classSection = `${classVal}${section}`; // e.g., "7thA"

        try {
            console.log('Checking vote for scholarNo:', scholarNo, 'in class/section:', classSection);
            const voteQuery = query(collection(db, `classes/${classSection}/votes`), where('scholarNo', '==', scholarNo));
            const voteSnapshot = await getDocs(voteQuery);
            if (!voteSnapshot.empty) {
                alert('You have already voted!');
                return;
            }

            console.log('Attempting to save vote for scholarNo:', scholarNo, 'with data:', { name, section, candidate });
            const voteRef = doc(db, `classes/${classSection}/votes`, scholarNo);
            await setDoc(voteRef, {
                name,
                section,
                scholarNo,
                candidate,
                timestamp: new Date()
            }, { merge: true });
            console.log('Vote saved successfully for scholarNo:', scholarNo);
            alert(`Thank you, ${name}! Your vote for ${candidate} has been recorded.`);
            document.getElementById('voteForm').reset();
        } catch (error) {
            console.error('Vote submission error:', error.code, error.message, error.details, error.stack);
            alert('Error submitting vote: ' + error.message);
        }
    });
</script>
</body>
</html>
